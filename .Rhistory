n <- 17; fac <- factor(rep_len(1:3, n), levels = 1:5)
table(fac)
tapply(1:n, fac, sum)
tapply(1:n, fac, sum, default = 0) # maybe more desirable
tapply(1:n, fac, sum, simplify = FALSE)
tapply(1:n, fac, range)
tapply(1:n, fac, quantile)
tapply(1:n, fac, length) ## NA's
tapply(1:n, fac, length, default = 0) # == table(fac)
## example of ... argument: find quarterly means
tapply(presidents, cycle(presidents), mean, na.rm = TRUE)
ind <- list(c(1, 2, 2), c("A", "A", "B"))
table(ind)
tapply(1:3, ind) #-> the split vector
tapply(1:3, ind, sum)
## Some assertions (not held by all patch propsals):
nq <- names(quantile(1:5))
stopifnot(
identical(tapply(1:3, ind), c(1L, 2L, 4L)),
identical(tapply(1:3, ind, sum),
matrix(c(1L, 2L, NA, 3L), 2, dimnames = list(c("1", "2"), c("A", "B")))),
identical(tapply(1:n, fac, quantile)[-1],
array(list(`2` = structure(c(2, 5.75, 9.5, 13.25, 17), names = nq),
`3` = structure(c(3, 6, 9, 12, 15), names = nq),
`4` = NULL, `5` = NULL), dim=4, dimnames=list(as.character(2:5)))))
View(warpbreaks)
setwd("C:\Users\me/)
setwd("C:\Users\me/")
setwd("C:\Users\me")
setwd("C:/Users/me/")
cd RStudio
setwd("C:/Users/me/rStudio/r_for_data_science/ch1_penguin_dimensions/)
"
]
setwd("C:/Users/me/rStudio/r_for_data_science/ch1_penguin_dimensions/")
setwd("C:/Users/me/rStudio/r_for_data_science/")
library(nycflights13)
library(tidyverse)
nycflights13::flights
glimpse(flights)
View(flights)
print(flights, width = Inf)
flights |>
filter(dep_delay > 120)
flights |>
filter(month == 1 & day == 1)
flights |>
filter(dest == "IAH") |>
group_by(year, month, day) |>
summarize(
arr_delay = mean(arr_delay, na.rm = TRUE)
)
flights |>
arrange(year, month, day, dep_time)
#> # A tibble: 336,776 × 19
#>    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#>   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
#> 1  2013     1     1      517            515         2      830            819
#> 2  2013     1     1      533            529         4      850            830
#> 3  2013     1     1      542            540         2      923            850
#> 4  2013     1     1      544            545        -1     1004           1022
#> 5  2013     1     1      554            600        -6      812            837
#> 6  2013     1     1      554            558        -4      740            728
#> # ℹ 336,770 more rows
#> # ℹ 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>, …
flights |>
distinct(origin, dest, .keep_all = FALSE)
#> # A tibble: 224 × 19
#>    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#>   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
#> 1  2013     1     1      517            515         2      830            819
#> 2  2013     1     1      533            529         4      850            830
#> 3  2013     1     1      542            540         2      923            850
#> 4  2013     1     1      544            545        -1     1004           1022
#> 5  2013     1     1      554            600        -6      812            837
#> 6  2013     1     1      554            558        -4      740            728
#> # ℹ 218 more rows
#> # ℹ 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>, …
flights |>
count(origin, dest, sort = TRUE)
#> # A tibble: 224 × 3
#>   origin dest      n
#>   <chr>  <chr> <int>
#> 1 JFK    LAX   11262
#> 2 LGA    ATL   10263
#> 3 LGA    ORD    8857
#> 4 JFK    SFO    8204
#> 5 LGA    CLT    6168
#> 6 EWR    ORD    6100
#> # ℹ 218 more rows
flights |>
count(origin, dest, sort = FALSE)
flights |>
mutate(
gain = dep_delay - arr_delay,
speed = distance / air_time * 60,
.before = 1
)
#> # A tibble: 336,776 × 21
#>    gain speed  year month   day dep_time sched_dep_time dep_delay arr_time
#>   <dbl> <dbl> <int> <int> <int>    <int>          <int>     <dbl>    <int>
#> 1    -9  370.  2013     1     1      517            515         2      830
#> 2   -16  374.  2013     1     1      533            529         4      850
#> 3   -31  408.  2013     1     1      542            540         2      923
#> 4    17  517.  2013     1     1      544            545        -1     1004
#> 5    19  394.  2013     1     1      554            600        -6      812
#> 6   -16  288.  2013     1     1      554            558        -4      740
#> # ℹ 336,770 more rows
#> # ℹ 12 more variables: sched_arr_time <int>, arr_delay <dbl>, …
flights |>
mutate(
gain = dep_delay - arr_delay,
speed = distance / air_time * 60,
.after = day
)
flights |>
select(year, month, day)
flights |>
select(!year:day)
flights |>
select(where(is.character))
flights
flights |>
relocate(time_hour, air_time)
#> # A tibble: 336,776 × 19
#>   time_hour           air_time  year month   day dep_time sched_dep_time
#>   <dttm>                 <dbl> <int> <int> <int>    <int>          <int>
#> 1 2013-01-01 05:00:00      227  2013     1     1      517            515
#> 2 2013-01-01 05:00:00      227  2013     1     1      533            529
#> 3 2013-01-01 05:00:00      160  2013     1     1      542            540
#> 4 2013-01-01 05:00:00      183  2013     1     1      544            545
#> 5 2013-01-01 06:00:00      116  2013     1     1      554            600
#> 6 2013-01-01 05:00:00      150  2013     1     1      554            558
#> # ℹ 336,770 more rows
#> # ℹ 12 more variables: dep_delay <dbl>, arr_time <int>, …
flights
flights |>
group_by(month) |>
summarize(
avg_delay = mean(dep_delay, na.rm = TRUE)
)
library(ggplot2)
flights |>
group_by(month) |>
summarize(avg_delay = mean(dep_delay, na.rm = TRUE)) |>
ggplot(aes(x = factor(month), y = avg_delay)) +
geom_col(fill = "steelblue") +
labs(title = "Average Departure Delay by Month",
x = "Month",
y = "Average Delay (minutes)")
flights |>
group_by(carrier) |>
summarize(
avg_delay = mean(dep_delay, na.rm = TRUE),
n_flights = n()
) |>
arrange(desc(avg_delay))
flights
flights <- flights
view(flights)
flights |>
summarize(
mean_delay = mean(dep_delay, na.rm = TRUE),
total_flights = n(),
unique_planes = n_distinct(tailnum)
)
flights |>
group_by(dest) |>
slice_max(arr_delay, n = 1) |>
relocate(dest)
#> # A tibble: 108 × 19
#> # Groups:   dest [105]
#>   dest   year month   day dep_time sched_dep_time dep_delay arr_time
#>   <chr> <int> <int> <int>    <int>          <int>     <dbl>    <int>
#> 1 ABQ    2013     7    22     2145           2007        98      132
#> 2 ACK    2013     7    23     1139            800       219     1250
#> 3 ALB    2013     1    25      123           2000       323      229
#> 4 ANC    2013     8    17     1740           1625        75     2042
#> 5 ATL    2013     7    22     2257            759       898      121
#> 6 AUS    2013     7    10     2056           1505       351     2347
#> # ℹ 102 more rows
#> # ℹ 11 more variables: sched_arr_time <int>, arr_delay <dbl>, …
flights |>
group_by(dest) |>
slice_max(arr_delay, n = 2) |>
relocate(dest)
#> # A tibble: 108 × 19
#> # Groups:   dest [105]
#>   dest   year month   day dep_time sched_dep_time dep_delay arr_time
#>   <chr> <int> <int> <int>    <int>          <int>     <dbl>    <int>
#> 1 ABQ    2013     7    22     2145           2007        98      132
#> 2 ACK    2013     7    23     1139            800       219     1250
#> 3 ALB    2013     1    25      123           2000       323      229
#> 4 ANC    2013     8    17     1740           1625        75     2042
#> 5 ATL    2013     7    22     2257            759       898      121
#> 6 AUS    2013     7    10     2056           1505       351     2347
#> # ℹ 102 more rows
#> # ℹ 11 more variables: sched_arr_time <int>, arr_delay <dbl>, …
daily <- flights |>
group_by(year, month, day)
daily
#> # A tibble: 336,776 × 19
#> # Groups:   year, month, day [365]
#>    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#>   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
#> 1  2013     1     1      517            515         2      830            819
#> 2  2013     1     1      533            529         4      850            830
#> 3  2013     1     1      542            540         2      923            850
#> 4  2013     1     1      544            545        -1     1004           1022
#> 5  2013     1     1      554            600        -6      812            837
#> 6  2013     1     1      554            558        -4      740            728
#> # ℹ 336,770 more rows
#> # ℹ 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>, …
View(daily)
daily
daily_flights <- daily |>
summarize(n = n())
#> `summarise()` has grouped output by 'year', 'month'. You can override using
#> the `.groups` argument.
View(daily_flights)
View(daily_flights)
daily_flights <- daily |>
summarize(
n = n(),
.groups = "drop_last"
)
daily_flights <- daily |>
summarize(n = n())
#> `summarise()` has grouped output by 'year', 'month'. You can override using
#> the `.groups` argument.
daily_flights <- daily |>
summarize(
n = n(),
.groups = "drop_last"
)
View(daily_flights)
View(daily_flights)
daily_flights <- daily |>
summarize(n = n())
#> `summarise()` has grouped output by 'year', 'month'. You can override using
#> the `.groups` argument.
daily |>
ungroup()
#> # A tibble: 336,776 × 19
#>    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#>   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
#> 1  2013     1     1      517            515         2      830            819
#> 2  2013     1     1      533            529         4      850            830
#> 3  2013     1     1      542            540         2      923            850
#> 4  2013     1     1      544            545        -1     1004           1022
#> 5  2013     1     1      554            600        -6      812            837
#> 6  2013     1     1      554            558        -4      740            728
#> # ℹ 336,770 more rows
#> # ℹ 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>, …
View(daily)
daily |>
ungroup() |>
summarize(
avg_delay = mean(dep_delay, na.rm = TRUE),
flights = n()
)
#> # A tibble: 1 × 2
#>   avg_delay flights
#>       <dbl>   <int>
#> 1      12.6  336776
View(daily)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_efficiency.R", echo = TRUE)
View(efficiency_audit)
View(efficiency_audit)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
performance_plot <- efficiency_data |>
mutate(carrier = fct_reorder(carrier, avg_gain)) |>
ggplot(aes(x = avg_gain, y = carrier)) +
# Use a single, professional high-contrast color (#0072B2 is Okabe-Ito Blue)
geom_col(fill = "#0072B2") +
labs(
title = "Flight Performance: Time Recovery by Carrier",
subtitle = "Average minutes recovered in-flight (NYC Departures, 2013)",
x = "Average Minutes Gained (Departure Delay - Arrival Delay)",
y = "Carrier Code",
caption = "Data: nycflights13 | Refined by: Nate Vavrock"
) +
theme_minimal(base_size = 12) +
theme(
panel.grid.minor = element_blank(),
plot.title = element_text(face = "bold", color = "#000000"),
axis.text = element_text(color = "#000000")
)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_efficiency.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_efficiency.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_efficiency.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_efficiency.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch3_data_transformation/ch3_flight_viz.R", echo = TRUE)
# Strive for
flights |>
filter(!is.na(arr_delay), !is.na(tailnum)) |>
count(dest)
# Avoid
flights|>filter(!is.na(arr_delay), !is.na(tailnum))|>count(dest)
flights |>
mutate(
speed      = distance / air_time,
dep_hour   = dep_time %/% 100,
dep_minute = dep_time %%  100
)
flights <- flights |>
mutate(
speed      = distance / air_time,
dep_hour   = dep_time %/% 100,
dep_minute = dep_time %%  100
)
View(flights)
826/282
827/282
sqrt(8)
source("C:/Users/me/rStudio/r_for_data_science/ch4_code_style/ch4_standardized_analysis.R", echo = TRUE)
source("C:/Users/me/rStudio/r_for_data_science/ch4_workflow_style/ch4_standardized_analysis.R", echo = TRUE)
View(flights_standardized)
# Standard: Standard 24-hour cycle check
filter(dep_hour < 24)
# ==============================================================================
# PROJECT: R for Data Science Technical Refinement
# MODULE:  Chapter 4 - Workflow: Code Style (Standardization Audit)
# AUTHOR:  Nate Vavrock
# LICENSE: MIT License (c) 2026 Nate Vavrock. See root LICENSE for terms.
# ==============================================================================
# ---- 1.0 Environment Setup ---------------------------------------------------
library(nycflights13)
library(tidyverse)
# ---- 2.0 Feature Engineering (The "Back Pocket" Engine) ----------------------
# Standard: Vertical Assignment Alignment and Cyclic Normalization.
# Logic: Using %% 24 to wrap '2400' midnight departures into the '0' hour block.
# ------------------------------------------------------------------------------
flights_standardized <- flights |>
filter(!is.na(dep_time)) |>
mutate(
dep_hour   = (dep_time %/% 100) %% 24,
dep_min    = dep_time %% 100,
sched_hour = (sched_dep_time %/% 100) %% 24,
sched_min  = sched_dep_time %% 100,
.keep      = "used"
)
# ---- 3.0 Audit Export --------------------------------------------------------
# Standard: Exporting a verification subset for "Data/Visual Parity."
# ------------------------------------------------------------------------------
write_csv(
x    = head(flights_standardized, 100),
file = "ch4_workflow_style/ch4_time_standardization_audit.csv"
)
# ---- 4.0 Performance Analytics -----------------------------------------------
# Logic: Aggregating by hour with normalized 0-23 range.
# ------------------------------------------------------------------------------
hourly_performance <- flights_standardized |>
group_by(dep_hour) |>
summarize(
avg_delay     = mean(dep_min, na.rm = TRUE),
flight_count  = n(),
.groups       = "drop"
)
# ---- 5.0 Visualization -------------------------------------------------------
# Standard: Explicit argument-per-line and high-resolution serialization.
# ------------------------------------------------------------------------------
performance_viz <- hourly_performance |>
ggplot(aes(x = dep_hour, y = avg_delay)) +
geom_line(color = "#0072B2", linewidth = 1) +
geom_point(color = "#0072B2", size = 2) +
scale_x_continuous(breaks = seq(0, 23, by = 2)) + # Clean 24-hr axis
labs(
title    = "Intra-Hour Departure Variance",
subtitle = "Standardized cyclic time decomposition (NYC 2013)",
x        = "Hour of Departure (0-23)",
y        = "Average Minute Component of Departure",
caption  = "Nate Standard: Cyclic Normalization & Style Audit"
) +
theme_minimal()
ggsave(
filename = "ch4_workflow_style/standardized_performance.png",
plot     = performance_viz,
width    = 8,
height   = 4,
dpi      = 300
)
View(flights_standardized)
source("C:/Users/me/rStudio/r_for_data_science/ch4_workflow_style/ch4_standardized_analysis.R", echo = TRUE)
View(flights_standardized)
View(flights_standardized)
# Tactic: Isolate the 3:00 AM hour block and calculate the mean
midnight_check <- flights_standardized |>
filter(dep_hour == 3) |>
summarize(
avg_min_at_hour_3 = mean(dep_min, na.rm = TRUE),
total_flights     = n()
)
print(midnight_check)
View(midnight_check)
# Tactic: Isolate the 3:00 AM hour block and calculate the mean
midnight_check <- flights_standardized |>
filter(dep_hour == 2) |>
summarize(
avg_min_at_hour_3 = mean(dep_min, na.rm = TRUE),
total_flights     = n()
)
print(midnight_check)
# Tactic: Isolate the 3:00 AM hour block and calculate the mean
midnight_check <- flights_standardized |>
filter(dep_hour == 1) |>
summarize(
avg_min_at_hour_3 = mean(dep_min, na.rm = TRUE),
total_flights     = n()
)
print(midnight_check)
# Tactic: Isolate the 3:00 AM hour block and calculate the mean
midnight_check <- flights_standardized |>
filter(dep_hour == 0) |>
summarize(
avg_min_at_hour_3 = mean(dep_min, na.rm = TRUE),
total_flights     = n()
)
print(midnight_check)
library(tidyverse)
table1
billboard
billboard |>
pivot_longer(
cols = starts_with("wk"),
names_to = "week",
values_to = "rank"
)
#> # A tibble: 24,092 × 5
#>    artist track                   date.entered week   rank
#>    <chr>  <chr>                   <date>       <chr> <dbl>
#>  1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
#>  2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
#>  3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
#>  4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
#>  5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87
#>  6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94
#>  7 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk7      99
#>  8 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk8      NA
#>  9 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk9      NA
#> 10 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10     NA
#> # ℹ 24,082 more rows
bb <- billboard |>
pivot_longer(
cols = starts_with("wk"),
names_to = "week",
values_to = "rank"
)
#> # A tibble: 24,092 × 5
#>    artist track                   date.entered week   rank
#>    <chr>  <chr>                   <date>       <chr> <dbl>
#>  1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
#>  2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
#>  3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
#>  4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
#>  5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87
#>  6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94
#>  7 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk7      99
#>  8 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk8      NA
#>  9 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk9      NA
#> 10 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10     NA
#> # ℹ 24,082 more rows
View(bb)
bc <- billboard |>
pivot_longer(
cols = starts_with("wk"),
names_to = "week",
values_to = "rank",
values_drop_na = TRUE
)
#> # A tibble: 5,307 × 5
#>   artist track                   date.entered week   rank
#>   <chr>  <chr>                   <date>       <chr> <dbl>
#> 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
#> 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
#> 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
#> 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
#> 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87
#> 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94
#> # ℹ 5,301 more rows
?pivot_longer
bd <-  billboard_longer <- billboard |>
pivot_longer(
cols = starts_with("wk"),
names_to = "week",
values_to = "rank",
values_drop_na = TRUE
) |>
mutate(
week = parse_number(week)
)
billboard_longer
#> # A tibble: 5,307 × 5
#>   artist track                   date.entered  week  rank
#>   <chr>  <chr>                   <date>       <dbl> <dbl>
#> 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26       1    87
#> 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26       2    82
#> 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26       3    72
#> 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26       4    77
#> 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26       5    87
#> 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26       6    94
#> # ℹ 5,301 more rows
View(bc)
View(bd)
is.infinite(7/9)
